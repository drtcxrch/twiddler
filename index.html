<!DOCTYPE html>
<html>
  <head>
    <title>Twiddler</title>
    <script src="jquery.js"></script>
    <script src="dataGenerator.js"></script>
  </head>

  <body>
    <div class="container">
      <button class="home">Home</button>
      <h1>Twiddler</h1>
      <div id="username">User <br><input id="username" type="text" name="username">
        <form id='submit' method='get' action=''>
        </form>
        <button class="submit">Tweed!</button>
      </div>
      <button id="tweet">Get latest Tweeds!</button>
      <div id="username"></div>
      <div class="tweets">
        <section class="main">

        </section>
      </div>
    </div>

    <script>


      $(document).ready(function(){
        var $body = $('.tweets');
        var currentFeedLength = 11;

        //Populate initial feed

        function poplulateFeed() {

          var index = streams.home.length - 1;
          while (index >= 0) {
            var tweet = streams.home[index];
            var $tweet = $('<div class="tweet"></div>');
            var $user = $('<p class="user"></p>');
            $('.home').hide();
           $tweet.appendTo('.main');
            $user.addClass(tweet.user).attr('data-user', tweet.user).html('<b>@' + tweet.user + ': </b>' + tweet.message + '<span> (Posted on <em> ' + tweet.created_at + ')</em></span>').appendTo($tweet);
            index -= 1;
          }
        }

        poplulateFeed();

        //Click function to get more tweets

        $("#tweet").click(function() {

          generateRandomTweet();

          var tweets = streams.home.slice(currentFeedLength);
          currentFeedLength = streams.home.length + 1;
          for (var i = 0; i < tweets.length; i++) {
            var tweet = tweets[i];
            var $tweet = $('<div class="tweet"></div>');
            var $user = $('<p class="user"></p>');
             $('.home').hide();
            $tweet.appendTo('.main');
            $user.addClass(tweet.user).attr('data-user', tweet.user).html('<b>@' + tweet.user + ': </b>' + tweet.message + '<span> (Posted on <em> ' + tweet.created_at + ')</em></span>').appendTo($tweet);
          }
        });

        //Go to user feed

        $('.tweets').on('click', '.user', function (event) {
          event.preventDefault();
          var user = $(this).data('user');
          $('.userpage').remove();
          var $userpage = $('<h1 class=userpage>' + user + '\'s Tweeds</h1>');
          $userpage.prependTo($body);
          $('.newTweets').hide();
          $('#username').hide();
          $('.home').show();
          $('#tweet').hide();
          $('.tweet').not("div:contains('" + user + "')").hide();
          $("div:contains('" + user + "')").show();

        });

              //Go back to main feed

        $('.home').click(function (event) {
          event.preventDefault();
          var user = $(this).data('user');
          $('.userpage').hide();
          $('.newTweets').show();
          $('#tweet').show();
          $('.home').hide();
          $('#username').show();
          $("div:contains('" + user + "')").hide();
          $('.tweet').not("div:contains('" + user + "')").show();

        })

                //Write new tweet

        var $textarea = $("<textarea placeholder='share your thoughts with the Twiddlerverse!' id='text' name='text' rows='3' style='overflow: hidden; word-wrap: break-word; resize: none; height: auto;'></textarea>");
        $textarea.appendTo('#submit');

        $('.submit').on('click', function () {

          var $tweet = $('<div class=tweet></div>');
          var $user = $('<p class=user></p>');

          $tweet.appendTo('.main');
          $user.addClass($('input#username').val()).attr('data-user', $('input#username').val()).html('<b>@' + $('input#username').val() + ': </b>' + $('textarea').val() + '<span> (Posted  on <em> ' + new Date() + ')</em></span>').appendTo($tweet);
          $('textarea').val('').blur();

        });
      });



    </script>
  </body>
</html>
